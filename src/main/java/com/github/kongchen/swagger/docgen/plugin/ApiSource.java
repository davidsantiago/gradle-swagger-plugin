package com.github.kongchen.swagger.docgen.plugin;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import org.reflections.Reflections;

import com.github.kongchen.swagger.docgen.GenerateException;
import com.github.kongchen.swagger.docgen.LogAdapter;

import io.swagger.annotations.Api;
import io.swagger.models.Info;

/**
 * Created with IntelliJ IDEA. User: kongchen Date: 3/7/13
 */
public class ApiSource {

    /**
     * Java classes containing Swagger's annotation <code>@Api</code>, or Java packages containing those classes can be
     * configured here, use ; as the delimiter if you have more than one location.
     */
    private String locations;

    private Info info;

    /**
     * The basePath of your APIs.
     */
    private String basePath;

    /**
     * The host (name or ip) serving the API. This MUST be the host only and does not include the scheme nor sub-paths.
     * It MAY include a port. If the host is not included, the host serving the documentation is to be used (including
     * the port). The host does not support path templating.
     */
    private String host;

    /**
     * The transfer protocol of the API. Values MUST be from the list: "http", "https", "ws", "wss" use ',' as delimiter
     */
    private String schemes;

    /**
     * <code>templatePath</code> is the path of a hbs template file, see more details in next section. If you don't want
     * to generate extra api documents, just don't set it.
     */
    private String templatePath;

    private String outputPath;

    private String outputFormats;

    private String swaggerDirectory;

    private String swaggerDirectoryEncoding;

    /**
     * <code>attachSwaggerArtifact</code> triggers plugin execution to attach the generated swagger.json to Maven
     * session for deployment purpose. The attached classifier is the directory name of <code>swaggerDirectory</code>
     */
    private boolean attachSwaggerArtifact;

    private String swaggerUIDocBasePath;

    private String modelSubstitute;

    private String apiSortComparator;

    /**
     * Information about swagger filter that will be used for prefiltering
     */
    private String swaggerInternalFilter;

    private String swaggerApiReader;

    private boolean springmvc;

    private boolean useJAXBAnnotationProcessor;

    private String swaggerSchemaConverter;

    private List<SecurityDefinition> securityDefinitions;

    private List<String> typesToSkip = new ArrayList<String>();

    private List<String> apiModelPropertyAccessExclusions = new ArrayList<String>();

    private boolean jsonExampleValues = false;

    public Set<Class<?>> getValidClasses(ClassLoader classLoader, LogAdapter logger) throws GenerateException {
        Set<Class<?>> classes = new HashSet<Class<?>>();
        if (getLocations() == null) {
            Set<Class<?>> c = new Reflections("").getTypesAnnotatedWith(Api.class);
            classes.addAll(c);
        } else {
            if (locations.contains(";")) {
                String[] sources = locations.split(";");
                for (String source : sources) {
                    Set<Class<?>> c = new Reflections(classLoader, source).getTypesAnnotatedWith(Api.class);
                    classes.addAll(c);
                }
            } else {
                classes.addAll(new Reflections(locations).getTypesAnnotatedWith(Api.class));
            }
        }

        return classes;
    }

    public List<String> getApiModelPropertyAccessExclusions() {
        return apiModelPropertyAccessExclusions;
    }

    public void setApiModelPropertyExclusions(List<String> apiModelPropertyAccessExclusions) {
        this.apiModelPropertyAccessExclusions = apiModelPropertyAccessExclusions;
    }

    public List<SecurityDefinition> getSecurityDefinitions() {
        return securityDefinitions;
    }

    public List<String> getTypesToSkip() {
        return typesToSkip;
    }

    public void setTypesToSkip(List<String> typesToSkip) {
        this.typesToSkip = typesToSkip;
    }

    public void setSecurityDefinitions(List<SecurityDefinition> securityDefinitions) {
        this.securityDefinitions = securityDefinitions;
    }

    public Info getInfo() {
        return info;
    }

    public void setInfo(Info info) {
        this.info = info;
    }

    public String getLocations() {
        return locations;
    }

    public void setLocations(String locations) {
        this.locations = locations;
    }

    public String getTemplatePath() {
        return templatePath;
    }

    public void setTemplatePath(String templatePath) {
        this.templatePath = templatePath;
    }

    public String getOutputPath() {
        return outputPath;
    }

    public void setOutputPath(String outputPath) {
        this.outputPath = outputPath;
    }

    public String getOutputFormats() {
        return outputFormats;
    }

    public void setOutputFormats(String outputFormats) {
        this.outputFormats = outputFormats;
    }

    public String getBasePath() {
        return basePath;
    }

    public void setBasePath(String basePath) {
        this.basePath = basePath;
    }

    public String getSwaggerDirectory() {
        return swaggerDirectory;
    }

    public void setSwaggerDirectory(String swaggerDirectory) {
        this.swaggerDirectory = swaggerDirectory;
    }

    public String getSwaggerDirectoryEncoding() {
        return swaggerDirectoryEncoding;
    }

    public void setSwaggerDirectoryEncoding(final String swaggerDirectoryEncoding) {
        this.swaggerDirectoryEncoding = swaggerDirectoryEncoding;
    }

    public boolean isAttachSwaggerArtifact() {
        return attachSwaggerArtifact;
    }

    public void setAttachSwaggerArtifact(boolean attachSwaggerArtifact) {
        this.attachSwaggerArtifact = attachSwaggerArtifact;
    }

    public void setSwaggerUIDocBasePath(String swaggerUIDocBasePath) {
        this.swaggerUIDocBasePath = swaggerUIDocBasePath;
    }

    public String getSwaggerUIDocBasePath() {
        return swaggerUIDocBasePath;
    }

    public String getHost() {
        return host;
    }

    public void setModelSubstitute(String modelSubstitute) {
        this.modelSubstitute = modelSubstitute;
    }

    public String getSwaggerInternalFilter() {
        return swaggerInternalFilter;
    }

    public void setSwaggerInternalFilter(String swaggerInternalFilter) {
        this.swaggerInternalFilter = swaggerInternalFilter;
    }

    public String getSwaggerApiReader() {
        return swaggerApiReader;
    }

    public void setSwaggerApiReader(String swaggerApiReader) {
        this.swaggerApiReader = swaggerApiReader;
    }

    public String getApiSortComparator() {
        return apiSortComparator;
    }

    public void setApiSortComparator(String apiSortComparator) {
        this.apiSortComparator = apiSortComparator;
    }

    public void setHost(String host) {
        this.host = host;
    }

    public String getSchemes() {
        return schemes;
    }

    public void setSchemes(String schemes) {
        this.schemes = schemes;
    }

    public String getModelSubstitute() {
        return modelSubstitute;
    }

    public boolean isSpringmvc() {
        return springmvc;
    }

    public void setSpringmvc(boolean springmvc) {
        this.springmvc = springmvc;
    }

    public String getSwaggerSchemaConverter() {
        return swaggerSchemaConverter;
    }

    public void setSwaggerSchemaConverter(String swaggerSchemaConverter) {
        this.swaggerSchemaConverter = swaggerSchemaConverter;
    }

    public boolean isJsonExampleValues() {
        return jsonExampleValues;
    }

    public void setJsonExampleValues(boolean jsonExampleValues) {
        this.jsonExampleValues = jsonExampleValues;
    }

    public boolean isUseJAXBAnnotationProcessor() {
        return useJAXBAnnotationProcessor;
    }

    public void setUseJAXBAnnotationProcessor(boolean useJAXBAnnotationProcessor) {
        this.useJAXBAnnotationProcessor = useJAXBAnnotationProcessor;
    }

    @Override
    public String toString() {
        final StringBuilder builder = new StringBuilder()//
                .append("ApiSource [")//
                .append("apiModelPropertyAccessExclusions=")//
                .append(apiModelPropertyAccessExclusions)//
                .append(",locations=\"")//
                .append(locations + "\"")//
                .append(",info=")//
                .append(info)//
                .append(",basePath=\"")//
                .append(basePath + "\"")//
                .append(",host=\"")//
                .append(host + "\"")//
                .append(",schemes=\"")//
                .append(schemes + "\"")//
                .append(",templatePath=\"")//
                .append(templatePath + "\"")//
                .append(",outputPath=\"")//
                .append(outputPath + "\"")//
                .append(",outputFormats=\"")//
                .append(outputFormats + "\"")//
                .append(",swaggerDirectory=\"")//
                .append(swaggerDirectory + "\"")//
                .append(",attachSwaggerArtifact=")//
                .append(attachSwaggerArtifact)//
                .append(",swaggerUIDocBasePath=\"")//
                .append(swaggerUIDocBasePath + "\"")//
                .append(",modelSubstitute=\"")//
                .append(modelSubstitute + "\"")//
                .append(",apiSortComparator=\"")//
                .append(apiSortComparator + "\"")//
                .append(",swaggerInternalFilter=\"")//
                .append(swaggerInternalFilter + "\"")//
                .append(",swaggerApiReader=\"")//
                .append(swaggerApiReader + "\"")//
                .append(",springmvc=")//
                .append(springmvc)//
                .append(",useJAXBAnnotationProcessor=")//
                .append(useJAXBAnnotationProcessor)//
                .append(",swaggerSchemaConverter=\"")//
                .append(swaggerSchemaConverter + "\"")//
                .append(",securityDefinitions=")//
                .append(securityDefinitions)//
                .append(",typesToSkip=")//
                .append(typesToSkip)//
                .append(",jsonExampleValues=")//
                .append(jsonExampleValues)//
                .append("]");
        return builder.toString();
    }
}
